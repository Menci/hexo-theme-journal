<%- include("_include/variables.ejs") %>
<%
config.__isIndex = true
%>
<%- include("_include/head.ejs") %>
<%- include("_include/container_head.ejs") %>
<%- include("_include/single_column_head.ejs") %>
<%- include("_include/side_nav.ejs") %>
<%- include("_include/extra_nav.ejs") %>

<%
function getFeaturedImage(item) {
    var featuredImage = item.featured_image;
    if (!featuredImage) return '';
    if (featuredImage.startsWith("http://") || featuredImage.startsWith("https://")) return featuredImage;
    return config.root + item.path + featuredImage;
}
%>

<div ref="streamContainer" class="stream-container">
    <div class="post-list-container post-list-container-no-background">
        <% page.posts.each(function (item) { %>
        <a href="<%= config.root + item.path %>" class="a-block">
            <div class="post-item-wrapper">
                <div class="post-item post-item-no-divider">
                    <div class="post-item-info-wrapper">
                        <div class="post-item-title">
                            <%= item.title %>
                        </div>
                        <div class="post-item-summary">
                            <% if (item.excerpt && item.excerpt.length > 0) { %>
                            <%- item.excerpt %>
                            <% } else { %>
                            <%= truncate(strip_html(item.content), {
                                length: config.truncate_len ? config.truncate_len : theme.truncate_len ? theme.truncate_len : 140,
                                omission: '...'
                            }) %>
                            <% } %>
                        </div>
                        <div class="post-item-meta">
                            <time datetime="<%= date_xml(item.date) %>" itemprop="datePublished">
                                <%= date(item.date, "YYYY-MM-DD") %>
                            </time>&nbsp;
                            <% if (item.categories && item.categories.length){ %>
                            <% count = item.categories.length %>
                            <i class="material-icons" style="">folder</i>
                            <% item.categories.forEach(function(category, index) { %>
                            <span><%= category.name %></span><%= (count !== index + 1) ? ', ' : '' %>
                            <% }); %>
                            <% } %>
        
                            <% if (item.tags && item.tags.length){ %>
                            <% count = item.tags.length %>
                            <i class="material-icons" style="">label</i>
                            <% item.tags.forEach(function(tag, index) { %>
                            <span><%= tag.name %></span><%= (count !== index + 1) ? ', ' : '' %>
                            <% }); %>
                            <% } %>
                        </div>
                    </div>
                    <% if(item.featured_image){ %>
                    <div class="post-item-image-wrapper">
                        <div class="post-item-image"
                             style="background-image: url('<%= getFeaturedImage(item) %>')"></div>
                    </div>
                    <% } %>
                </div>
            </div>
        </a>
        <% }) %>
    
        <%- include("_include/pagination.ejs") %>
    </div>
    <%- include("_include/single_column_footer.ejs") %>
</div>

<%- include("_include/container_tail.ejs") %>
<%- include("_include/tail.ejs") %>
